function G(j,x=document){return x.querySelector(j)}function J(j,x=document){return[...x.querySelectorAll(j)]}var Y={};async function Q(j,x){if(dispatchEvent(new Event("before:route")),Y[location.pathname]=window.scrollY,!x)history.pushState({path:j},0,j);let z=v(await D(j)),E=G("title",z)?.textContent;if(E)document.title=E;let F='[name="nue:components"]';G(F).content=G(F,z).content;for(let I of J("script[src]",z))await import(I.getAttribute("src"));let K=R(z);k(K,()=>{let I=U(G("main"),G("main",z));U(G("body"),G("body2",z),I);let{hash:O}=location,N=O&&G(O);scrollTo(0,N?N.offsetTop-parseInt(getComputedStyle(N).scrollMarginTop)||0:0),dispatchEvent(new Event("route"));let[P,B]=location.pathname.split("/");dispatchEvent(new Event(`route:${B||"home"}`)),Z(j)})}function C(j,x){j.addEventListener("click",(z)=>{let E=z.target.closest("[href]"),F=E?.getAttribute("href"),K=E?.getAttribute("target"),I=F?.split("/")?.pop()?.split(/[#?]/)?.shift();if(z.defaultPrevented||z.metaKey||z.ctrlKey||z.shiftKey||z.altKey||!F||F[0]=="#"||F?.includes("//")||F?.startsWith("mailto:")||I?.includes(".")&&!I?.endsWith(".html")||!!K)return;if(F!=location.pathname)x(F,E);z.preventDefault()})}function H(j){let x=location.pathname;return x.slice(0,x.lastIndexOf("/")+1)+j}function Z(j,x="aria-current"){if(j[0]!="/")j=H(j);J(`[${x}]`).forEach((z)=>z.removeAttribute(x)),J("a").forEach((z)=>{if(!z.hash&&z.pathname==j)setTimeout(()=>z.setAttribute(x,"page"),50)})}var L=typeof window=="object";if(L){if(!document.startViewTransition)document.startViewTransition=(j)=>j();history.pushState({path:location.pathname},0),C(document,async(j,x)=>{let z=G("img",x);if(z)z.style.viewTransitionName="active-image";document.startViewTransition(async()=>{await Q(j)})}),Z(location.pathname),addEventListener("popstate",(j)=>{let{path:x}=j.state||{};if(x){let z=Y[x];document.startViewTransition(async()=>{await Q(x,!0),setTimeout(()=>window.scrollTo(0,z||0),10)})}})}function U(j,x,z){if(j.classList.value=x.classList.value,j.children.length==x.children.length)return[...j.children].forEach((E,F)=>{if(!(z&&E.tagName=="MAIN"))M(E,x.children[F])}),!0;else j.innerHTML=x.innerHTML}function M(j,x){if(j.outerHTML.replace(' aria-current="page"',"")!=x.outerHTML)j.replaceWith(x.cloneNode(!0))}function R(j){let x=J("link, style"),z=T(x,J("link, style",j));return z.forEach((E)=>G("head").appendChild(E)),A(j),z.filter((E)=>E.tagName=="link")}function V(j,x){return x.find((z)=>z.getAttribute("href")==j.getAttribute("href"))}function T(j,x){return j.forEach((z,E)=>z.disabled=!V(z,x)),x.filter((z)=>!V(z,j))}function W(j){return J("style",j).find((x)=>!x.attributes.length)}function A(j){let x=W(),z=W(j);if(x)x.replaceWith(z);else if(z)G("head").appendChild(z)}var X={};async function D(j){let x=X[j];if(x)return x;let z=await fetch(j);if(x=await z.text(),z.status==404&&x?.trim()[0]!="<"){let E=document.title="Page not found";G("article").innerHTML=`<section><h1>${E}</h1></section>`}else X[j]=x;return x}function v(j){j=j.replace(/<(\/?)body/g,"<$1body2");let x=document.createElement("template");return x.innerHTML=j.trim(),x.content}function k(j,x){let z=0;!j[0]?x():j.forEach((E,F)=>{q(E.href,()=>{if(++z==j.length)x()})})}function q(j,x){let z=document.createElement("link");z.rel="stylesheet",z.href=j,G("head").appendChild(z),z.onload=x}export{Z as setActive,C as onclick,Q as loadPage,J as $$,G as $};
